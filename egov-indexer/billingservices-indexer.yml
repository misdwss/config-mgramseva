ServiceMaps:
 serviceName: Billing Service
 version: 1.0.0
 mappings:
  - topic: create-demand-index
    configKey: INDEX
    indexes:
    - name: demandindex-v1
      type: demands
      id: $.id, $.tenantId
      isBulk: true
      jsonPath: $.Demands.*
      timeStampField: $.auditDetails.createdTime
      customJsonMapping:
        indexMapping: { "Data": { } }
        fieldMapping:
          - inJsonPath: $
            outJsonPath: $.Data
        mdmsMapping:
          - path: http://mdms-v2.mgramseva:8080/mdms-v2/v1/_search
            moduleName: tenant
            masterName: tenants
            tenantId: pb
            filter: "[?(@.code == $tenant)]"
            filterMapping:
              - variable: $tenant
                valueJsonpath: $.tenantId
            uriResponseMapping:
              - inJsonPath: $.MdmsRes.tenant.tenants
                outJsonPath: $.Data.tenantData

  - topic: update-demand-index
    configKey: INDEX
    indexes:
      - name: demandindex-v1
        type: demands
        id: $.id, $.tenantId
        isBulk: true
        jsonPath: $.Demands.*
        timeStampField: $.auditDetails.lastModifiedTime
        customJsonMapping:
          indexMapping: { "Data": { } }
          fieldMapping:
            - inJsonPath: $
              outJsonPath: $.Data
          mdmsMapping:
            - path: http://mdms-v2.mgramseva:8080/mdms-v2/v1/_search
              moduleName: tenant
              masterName: tenants
              tenantId: pb
              filter: "[?(@.code == $tenant)]"
              filterMapping:
                - variable: $tenant
                  valueJsonpath: $.tenantId
              uriResponseMapping:
                - inJsonPath: $.MdmsRes.tenant.tenants
                  outJsonPath: $.Data.tenantData


  - topic: demand-enrich-legacyindex
    configKey: LEGACYINDEX
    indexes:
      - name: demand-enriched-index
        type: demand
        id: $.id, $.tenantId
        isBulk: true
        timeStampField: $.auditDetails.createdTime
        jsonPath: $.Demands.*
        customJsonMapping:
          indexMapping: {"Data":{}}
          fieldMapping:
            - inJsonPath: $
              outJsonPath: $.Data
          mdmsMapping:
            - path: http://mdms-v2.mgramseva:8080/mdms-v2/v1/_search
              moduleName: tenant
              masterName: tenants
              tenantId: pb
              filter: "[?(@.code == $tenant)]"
              filterMapping:
                - variable: $tenant
                  valueJsonpath: $.tenantId
              uriResponseMapping:
                - inJsonPath: $.MdmsRes.tenant.tenants
                  outJsonPath: $.Data.tenantData